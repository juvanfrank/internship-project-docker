# Database Usage in This Project

This project uses **two separate databases** for different purposes, as required:

## üìä Database Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    USER REGISTRATION                     ‚îÇ
‚îÇ              (All data collected together)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ      REGISTER.PHP              ‚îÇ
         ‚îÇ   (Registration Handler)       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                                   ‚îÇ
        ‚ñº                                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    MySQL     ‚îÇ                   ‚îÇ   MongoDB    ‚îÇ
‚îÇ  (Structured)‚îÇ                   ‚îÇ (Document DB)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÑÔ∏è MySQL Database - Authentication Data

### Purpose
MySQL stores **ONLY authentication/registration data** (email and password).

### Table Structure
Located in: `init.sql`

```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,        -- User's email (unique)
    password_hash VARCHAR(255) NOT NULL,        -- Hashed password (BCRYPT)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### What's Stored in MySQL:
‚úÖ **Email** - User's email address (unique identifier)  
‚úÖ **Password Hash** - Hashed password using `password_hash()` with BCRYPT  
‚úÖ **Created At** - Timestamp of account creation  
‚úÖ **User ID** - Auto-incrementing primary key

### Usage in Code:

#### 1. Registration (`register.php`)
```php
// Insert authentication data into MySQL
$stmt = $mysqli->prepare("INSERT INTO users (email, password_hash) VALUES (?, ?)");
$stmt->bind_param("ss", $email, $password_hash);
$stmt->execute();
```
- Uses **Prepared Statements** (required)
- Stores email and hashed password
- Email must be unique (enforced by database)

#### 2. Login (`login.php`)
```php
// Verify credentials from MySQL
$stmt = $mysqli->prepare("SELECT password_hash FROM users WHERE email=?");
$stmt->bind_param("s", $email);
$stmt->execute();
// Verify password using password_verify()
```
- Retrieves password hash from MySQL
- Verifies password using PHP's `password_verify()`
- Uses **Prepared Statements** (required)

---

## üçÉ MongoDB Database - User Profile Details

### Purpose
MongoDB stores **user profile details** (name, age, date of birth, contact).

### Collection Structure
Collection Name: `profiles`  
Database Name: `internship_db`

### Document Structure (JSON-like):
```json
{
    "_id": ObjectId("..."),           // Auto-generated by MongoDB
    "email": "user@example.com",       // Links to MySQL users table
    "name": "John Doe",                // User's full name
    "age": "25",                       // User's age
    "dob": "1998-05-15",               // Date of birth
    "contact": "+1234567890",          // Contact number
    "created_at": ISODate("2025-11-23T12:00:00Z")  // Timestamp
}
```

### What's Stored in MongoDB:
‚úÖ **Name** - User's full name  
‚úÖ **Age** - User's age  
‚úÖ **Date of Birth (DOB)** - Birth date  
‚úÖ **Contact** - Phone/contact number  
‚úÖ **Email** - Used to link with MySQL (not unique in MongoDB, but unique in MySQL)

### Usage in Code:

#### 1. Registration (`register.php`)
```php
// Insert profile details into MongoDB
$profileData = [
    'email' => $email,
    'name' => $name,
    'age' => $age,
    'dob' => $dob,
    'contact' => $contact,
    'created_at' => new MongoDB\BSON\UTCDateTime()
];

$result = $profiles->insertOne($profileData);
```
- Stores all profile information
- Uses email as a link between MySQL and MongoDB

#### 2. Profile Retrieval (`profile.php`)
```php
// Fetch profile details from MongoDB
$profile = $profiles->findOne(['email' => $email]);
```
- Retrieves profile by email (the link field)
- Returns all profile details (name, age, dob, contact)

---

## üîÑ Data Flow Examples

### 1. User Registration Flow

```
User fills registration form
    ‚Üì
All data sent to register.php
    ‚Üì
    ‚îú‚îÄ‚Üí MySQL: Stores (email, password_hash)
    ‚îÇ   ‚îî‚îÄ Uses Prepared Statement
    ‚îÇ
    ‚îî‚îÄ‚Üí MongoDB: Stores (email, name, age, dob, contact)
        ‚îî‚îÄ Uses MongoDB insertOne()
    ‚Üì
Both operations in transaction
    ‚Üì
Success/Error response
```

### 2. User Login Flow

```
User enters email & password
    ‚Üì
login.php receives credentials
    ‚Üì
MySQL: SELECT password_hash WHERE email=?
    ‚Üì
password_verify() checks password
    ‚Üì
If valid:
    ‚îú‚îÄ Generate session token
    ‚îú‚îÄ Store session in Redis (email + timestamp)
    ‚îî‚îÄ Return session_token to frontend
```

### 3. Profile View Flow

```
User accesses profile page
    ‚Üì
profile.php receives session_token
    ‚Üì
Redis: Get session data (contains email)
    ‚Üì
MongoDB: Find profile WHERE email = ?
    ‚Üì
Return profile data (name, age, dob, contact)
```

---

## üîó Linking MySQL and MongoDB

The **email** field is used as the **link** between the two databases:

- **MySQL**: Email is the unique identifier (UNIQUE constraint)
- **MongoDB**: Email is stored in each profile document (used for lookup)

When retrieving profile data:
1. Get email from session (stored in Redis)
2. Use email to query MongoDB: `findOne(['email' => $email])`
3. Return profile details

---

## ‚úÖ Key Requirements Met

1. ‚úÖ **MySQL for registration data** - Only stores email and password hash
2. ‚úÖ **MongoDB for user profiles** - Stores name, age, dob, contact
3. ‚úÖ **Prepared Statements** - All MySQL queries use prepared statements
4. ‚úÖ **Separate Storage** - Authentication vs. Profile data clearly separated
5. ‚úÖ **Email as Link** - Email connects the two databases

---

## üìù Summary Table

| Database | Purpose | Data Stored | Queries Used |
|----------|---------|-------------|--------------|
| **MySQL** | Authentication | Email, Password Hash | Prepared Statements (INSERT, SELECT) |
| **MongoDB** | User Profiles | Name, Age, DOB, Contact | insertOne(), findOne() |
| **Redis** | Sessions | Session tokens, email | setex(), get(), del() |

---

## üîç File Locations

- **MySQL Schema**: `init.sql`
- **MySQL Connection**: `app/php/config.php` (lines 10-17)
- **MongoDB Connection**: `app/php/config.php` (lines 19-28)
- **Registration Logic**: `app/php/register.php`
- **Login Logic**: `app/php/login.php`
- **Profile Logic**: `app/php/profile.php`

---

This architecture ensures:
- **Security**: Sensitive authentication data in structured MySQL
- **Flexibility**: Profile data in flexible MongoDB schema
- **Performance**: Fast session lookups in Redis
- **Separation of Concerns**: Each database handles its specific purpose


